<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="js/jquery-2.1.3.min.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load('current', {
        'packages':['geochart'],
      });
      google.charts.setOnLoadCallback(drawRegionsMap);

      function drawRegionsMap() {
        var data = google.visualization.arrayToDataTable([
          ['Country', 'Popularity'],
          ['Germany', 200],
          ['United States', 300],
          ['Brazil', 400],
          ['Canada', 500],
          ['France', 600],
          ['RU', 700]
        ]);

        var options = {};

        var chart = new google.visualization.GeoChart(document.getElementById('regions_div'));

        chart.draw(data, options);
      }
    </script>
    <link rel="stylesheet" href="css/sample.css">
    <title>Planet Earth & Divers</title>

</head>

<header>
	<div class="earth"></div>
	<div class="h1-wapper">
		<h1>PLANET EARTH & DIVERS</h1>
	</div>
	<div>
		<nav class="navigation">
			<ul class="nav-list">
			   <li class="nav-item"><a class="a" href="#divelog">Dive Log</a></li>
			   <li class="nav-item"><a class="a" href="#divesites">Dive Sites</a></li>
			   <li class="nav-item"><a class="a" href="#project">Project</a></li>
			</ul>
		 </nav>
	</div>
</header>

<main>

	<div class="flex-container">
		<div class="flex-item">
			<div class="image-wrap">
				<img src="img/coral_1.jpg" alt="coral01" id="gu_btn" class="user_btn">
			</div>
		</div>
		<div class="flex-item">
			<div class="image-wrap">
				<img src="img/coral_2.png" alt="coral02" id="cho_btn" class="user_btn">
			</div>
		</div>
		<div class="flex-item">
			<div class="image-wrap">
				<img src="img/coral_3.jpg" alt="coral03" id="par_btn" class="user_btn">
			</div>
		</div>
		
	</div>


        <!-- log form -->
        <section id="divelog">
            <h2>Dive Log</h2>
            <form action="#" method="POST"></form>

            <table class="form-inner">
            <tr>
                <th class="form-title">Date
                </th>
                <td class="form-item"><input type="date" name="date" class="form__column"></td> 
            </tr>
            <tr>
                <th class="form-title">Entry Time
                </th>
                <td class="form-item"><input type="time" name="time" class="form__column"></td> 
            </tr>
            <tr>
                <th class="form-title">Exit Time
                </th>
                <td class="form-item"><input type="time" name="time" class="form__column"></td> 
            </tr>
            <tr>
                <th class="form-title">Country</th>
                <td class="form-item"><input type="text" name="location" class="form__column"></td> 
            </tr>
            <tr>
                <th class="form-title">Location</th>
                <td class="form-item"><input type="email" name="email" class="form__column"></td>  
            </tr>
            <tr>
                <th class="form-title"><br>Whether</th>
                    <td class="form-item">
                        <select class="form__column">
                        <option>Sunny</option>
                        <option>Cloudy</option>
                        <option>Rainy</option>
                        <option>Others</option>
                    </select>
                </td>
            </tr>
            <tr>
                <th class="form-title">Suite</th>
                    <td class="form-item">                     
                        <label for="startup" class="form__label"><input type="checkbox" name="kind" id="startup" value="wet suite">Wet Suite</label>
                        <br><label for="career" class="form__label"><input type="checkbox" name="kind" id="career" value="dry suite">Dry Suite</label>
                        <br><label for="job" class="form__label"><input type="checkbox" name="kind" id="job" value="jacket">Jacket</label>
                        <br><label for="hobby" class="form__label"><input type="checkbox" name="kind" id="hobby" value="head cover">Head Cover
                        </label>
                    </td>
            </tr>
            <tr>
                <th class="form-title">Comments</th>
                    <td class="form-item">
                        <textarea name="detail" cols="30" rows="10" class="form__column"></textarea>
                    </td>
            </tr>
            </tr>
            </table> 

            <div class="submit-wrapper">
            <input type="submit" value="Submit" class="btn">
            </div>
        </section>

           <!-- memo -->
        <section>
            <h2>Dive Diary</h2>

            <div class="memoarea">
                <input type="text" id="key">
                <textarea id="memo"></textarea>
                <ul>
                    <li id="save">Save</li>
                    <li id="clear">Clear</li>
                </ul>
            </div>


            <table id="list">
            <!-- ここに追加データが挿入される -->
            </table>
        </section>

        <!-- world map -->
        <div id="regions_div" style="width: 900px; height: 500px;"></div>

        <!-- カレンダー -->

        <div class="wrapper">
            <!-- xxxx年xx月を表示 -->
            <h1 id="header"></h1>

            <!-- ボタンクリックで月移動 -->
            <div id="next-prev-button">
                <button id="prev" onclick="prev()">‹</button>
                <button id="next" onclick="next()">›</button>
            </div>

            <!-- カレンダー -->
            <div id="calendar"></div>
        </div>
    </main>

<script>

    // 0. DiveLog クリックでメモ表示

    // 1.Saveクリックイベント
    $("#save").on("click",function(){
        const key =$("#key").val();
        const value =$("#memo").val();
        localStorage.setItem(key,value);

        const html = '<tr><th>'+key+'</th><td>'+value+'</td></tr>';
            $("#list").append(html);

            $("#key").val("");
            $("#memo").val("");
        
    });

    // 2.Clear
    $("#clear").on("click",function(){
        localStorage.clear();
        $("#list").empty();
    });
    //3.ページ読み込み：保存データ取得表示

    for(let i=0; i< localStorage.length; i++){
        const key = localStorage.key(i);
        const value = localStorage.getItem(key);

        const html = `
            <tr>
                <th>${key}</th>
                <td>${value}</td>
            </tr>
    `
        $("#list").append(html);
    };

    // フォーム日付
    let date = document.querySelector(`input[type='date'][name='date']`);

    date.addEventListener(`change`, () => {
        document.querySelector(`#output`).innerHTML = date.value;
    });

    // WOrld Map
        google.charts.load('current', {
    'packages':['geochart'],
    'mapsApiKey': 'AIzaSyBEa1T_F6ngy7gP9_nrXXTSZmVfqsYon3M'
    });

    google.charts.setOnLoadCallback(drawRegionsMap);

    function selectHandler(reg) {
    alert('あなたがクリックした国の国名コードは'+ reg.region + 'です。');
    }

    function drawRegionsMap() {
    const codes = [
        ['Country', 'Name'],
        ['Germany', 'ドイツ'],
        ['United States', 'アメリカ'],
        ['Brazil', 'ブラジル'],
        ['Canada', 'カナダ'],
        ['France', 'フランス'],
        ['RU', 'ロシア'],
        ['JP', 'にほん']
    ];
    const data = google.visualization.arrayToDataTable(codes);
    const options = {
        defaultColor:'#3cb371',
    };
    const chart = new google.visualization.GeoChart(document.getElementById('regions_div'));

    google.visualization.events.addListener(chart, 'regionClick', selectHandler);
    chart.draw(data, options);
    }

    // カレンダー
    const week = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
    const today = new Date();
    // 月末だとずれる可能性があるため、1日固定で取得
    var showDate = new Date(today.getFullYear(), today.getMonth(), 1);

    // 初期表示
    window.onload = function () {
        showProcess(today, calendar);
    };
    // 前の月表示
    function prev(){
        showDate.setMonth(showDate.getMonth() - 1);
        showProcess(showDate);
    }

    // 次の月表示
    function next(){
        showDate.setMonth(showDate.getMonth() + 1);
        showProcess(showDate);
    }

    // カレンダー表示
    function showProcess(date) {
        var year = date.getFullYear();
        var month = date.getMonth();
        document.querySelector('#header').innerHTML = year + " " + (month + 1) + "";

        var calendar = createProcess(year, month);
        document.querySelector('#calendar').innerHTML = calendar;
    }

    // カレンダー作成
    function createProcess(year, month) {
        // 曜日
        var calendar = "<table><tr class='dayOfWeek'>";
        for (var i = 0; i < week.length; i++) {
            calendar += "<th>" + week[i] + "</th>";
        }
        calendar += "</tr>";

        var count = 0;
        var startDayOfWeek = new Date(year, month, 1).getDay();
        var endDate = new Date(year, month + 1, 0).getDate();
        var lastMonthEndDate = new Date(year, month, 0).getDate();
        var row = Math.ceil((startDayOfWeek + endDate) / week.length);

        // 1行ずつ設定
        for (var i = 0; i < row; i++) {
            calendar += "<tr>";
            // 1colum単位で設定
            for (var j = 0; j < week.length; j++) {
                if (i == 0 && j < startDayOfWeek) {
                    // 1行目で1日まで先月の日付を設定
                    calendar += "<td class='disabled'>" + (lastMonthEndDate - startDayOfWeek + j + 1) + "</td>";
                } else if (count >= endDate) {
                    // 最終行で最終日以降、翌月の日付を設定
                    count++;
                    calendar += "<td class='disabled'>" + (count - endDate) + "</td>";
                } else {
                    // 当月の日付を曜日に照らし合わせて設定
                    count++;
                    if(year == today.getFullYear()
                    && month == (today.getMonth())
                    && count == today.getDate()){
                        calendar += "<td class='today'>" + count + "</td>";
                    } else {
                        calendar += "<td>" + count + "</td>";
                    }
                }
            }
            calendar += "</tr>";
        }
        return calendar;
    }

</script>

<footer><small>Chika Iwanaga</small></footer>
</body>
</html>